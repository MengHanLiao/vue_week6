"use strict";(self["webpackChunkvue_week6"]=self["webpackChunkvue_week6"]||[]).push([[459],{459:function(e,s,t){t.r(s),t.d(s,{default:function(){return Y}});var a=t(3396),l=t(7139),r=t(9242);const o={class:"container"},n={class:"mt-4"},d=(0,a._)("h3",{class:"text-center"},"購物車",-1),u={class:"table align-middle"},i=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th"),(0,a._)("th",null,"品名"),(0,a._)("th",{style:{width:"150px"}},"數量/單位"),(0,a._)("th",{class:"text-end"},"單價")])],-1),c=["onClick"],m=(0,a._)("i",{class:"fas fa-spinner fa-pulse"},null,-1),p=(0,a.Uk)(" x "),h=[m,p],_={class:"input-group input-group-sm"},b={for:"productNum",class:"input-group"},f=["onUpdate:modelValue","onBlur"],v={class:"input-group-text",id:"basic-addon2"},g={class:"text-end"},y=(0,a._)("small",{class:"text-success"},"折扣價：",-1),k={key:1},w={colspan:"4"},x=(0,a.Uk)(" 前往選購 "),V=(0,a.Uk)("商品頁面"),C=(0,a._)("td",{colspan:"3",class:"text-end"},"總計",-1),F={class:"text-end"},U={class:"my-5 row justify-content-center"},W=(0,a._)("h3",{class:"text-center"},"購買者資訊",-1),$={class:"mb-3"},q=(0,a._)("label",{for:"email",class:"form-label"},"Email",-1),z={class:"mb-3"},D=(0,a._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),N={class:"mb-3"},I=(0,a._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),O={class:"mb-3"},j=(0,a._)("label",{for:"address",class:"form-label"},"收件人地址",-1),B={class:"mb-3"},E=(0,a._)("label",{for:"message",class:"form-label"},"留言",-1),P={class:"text-end"},S=["disabled"];function H(e,s,t,m,p,H){const K=(0,a.up)("router-link"),L=(0,a.up)("v-field"),T=(0,a.up)("error-message"),Y=(0,a.up)("v-form");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",o,[(0,a._)("div",n,[d,(0,a._)("table",u,[i,(0,a._)("tbody",null,[0!==p.carts.carts.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(p.carts.carts,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>H.deleteItem(e.id)},h,8,c)]),(0,a._)("td",null,(0,l.zw)(e.product.title),1),(0,a._)("td",null,[(0,a._)("div",_,[(0,a._)("label",b,[(0,a.wy)((0,a._)("input",{min:"1",type:"number",class:"form-control",id:"productNum","onUpdate:modelValue":s=>e.qty=s,onBlur:s=>H.updateCart(e.id,e.product.id,e.qty)},null,40,f),[[r.nr,e.qty,void 0,{number:!0}]]),(0,a._)("span",v,(0,l.zw)(e.product.unit),1)])])]),(0,a._)("td",g,[y,(0,a.Uk)(" "+(0,l.zw)(e.total),1)])])))),128)):((0,a.wg)(),(0,a.iD)("tr",k,[(0,a._)("td",w,[x,(0,a.Wm)(K,{to:"/products",class:"btn btn-primary"},{default:(0,a.w5)((()=>[V])),_:1})])]))]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[C,(0,a._)("td",F,"NT$ "+(0,l.zw)(p.carts.final_total),1)])])])]),(0,a._)("div",U,[W,(0,a.Wm)(Y,{ref:"form",class:"col-md-6",onSubmit:H.submitOrder},{default:(0,a.w5)((({errors:e})=>[(0,a._)("div",$,[q,(0,a.Wm)(L,{id:"email",name:"email",type:"email",class:(0,l.C_)(["form-control",{"is-invalid":e["email"]}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:p.userForm.user.email,"onUpdate:modelValue":s[0]||(s[0]=e=>p.userForm.user.email=e)},null,8,["class","modelValue"]),(0,a.Wm)(T,{name:"email",class:"invalid-feedback"})]),(0,a._)("div",z,[D,(0,a.Wm)(L,{id:"name",name:"姓名",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:p.userForm.user.name,"onUpdate:modelValue":s[1]||(s[1]=e=>p.userForm.user.name=e)},null,8,["class","modelValue"]),(0,a.Wm)(T,{name:"姓名",class:"invalid-feedback"})]),(0,a._)("div",N,[I,(0,a.Wm)(L,{id:"tel",name:"電話",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["電話"]}]),placeholder:"請輸入電話",rules:H.isPhone,modelValue:p.userForm.user.tel,"onUpdate:modelValue":s[2]||(s[2]=e=>p.userForm.user.tel=e)},null,8,["class","rules","modelValue"]),(0,a.Wm)(T,{name:"電話",class:"invalid-feedback"})]),(0,a._)("div",O,[j,(0,a.Wm)(L,{id:"address",name:"地址",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:p.userForm.user.address,"onUpdate:modelValue":s[3]||(s[3]=e=>p.userForm.user.address=e)},null,8,["class","modelValue"]),(0,a.Wm)(T,{name:"地址",class:"invalid-feedback"})]),(0,a._)("div",B,[E,(0,a.wy)((0,a._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=e=>p.userForm.message=e)},null,512),[[r.nr,p.userForm.message]])]),(0,a._)("div",P,[(0,a._)("button",{type:"submit",class:"btn btn-danger",disabled:0===p.carts.carts.length&&0===Object.keys(e).length}," 送出訂單 ",8,S)])])),_:1},8,["onSubmit"])])])])}var K={data(){return{carts:{carts:[]},userForm:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCarts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/meng001/cart").then((e=>{this.carts=e.data.data})).catch((e=>{alert(e.response.data.message)}))},updateCart(e,s,t=1){if(t>0&&Number.isInteger(t)){const a={product_id:s,qty:t};this.$http.put(`https://vue3-course-api.hexschool.io/v2/api/meng001/cart/${e}`,{data:a}).then((()=>{alert("成功更新商品數量"),this.isLoading=!1})).catch((e=>{console.dir(e)}))}},deleteItem(e){this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/meng001/cart/${e}`).then((()=>{this.getCarts(),alert("成功刪除商品")})).catch((e=>{alert(e.response.data.message)}))},isPhone(e){const s=/^(09)[0-9]{8}$/;return!!s.test(e)||"需要正確的電話號碼"},submitOrder(){this.$http.post("https://vue3-course-api.hexschool.io/v2/api/meng001/order",{data:this.userForm}).then((()=>{alert("訂單成功送出"),this.carts.carts=[],this.$refs.form.resetForm(),this.message=""})).catch((e=>{alert(e.response.data.message)}))}},mounted(){this.getCarts()}},L=t(89);const T=(0,L.Z)(K,[["render",H]]);var Y=T}}]);
//# sourceMappingURL=459.06169330.js.map